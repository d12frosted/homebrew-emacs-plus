name: Emacs (default)

on:
  push:
    branches:
      - master
    paths:
      - "Aliases/emacs-plus"
      - "Library/Icons.rb"
      - "icons"
      - ".github/workflows/emacs.yml"
  pull_request:
    paths:
      - "Aliases/emacs-plus"
      - "Library/Icons.rb"
      - "icons"
      - ".github/workflows/emacs.yml"
  schedule:
    - cron: "0 */12 * * *"

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [macos-11]
        build_opts:
          - ""
          - "--build-from-source"
          # iconset begin
          - "--with-cacodemon-icon"
          - "--with-elrumo1-icon"
          - "--with-elrumo2-icon"
          - "--with-emacs-card-blue-deep-icon"
          - "--with-emacs-card-british-racing-green-icon"
          - "--with-emacs-card-carmine-icon"
          - "--with-emacs-card-green-icon"
          - "--with-EmacsIcon1-icon"
          - "--with-EmacsIcon2-icon"
          - "--with-EmacsIcon3-icon"
          - "--with-EmacsIcon4-icon"
          - "--with-EmacsIcon5-icon"
          - "--with-EmacsIcon6-icon"
          - "--with-EmacsIcon7-icon"
          - "--with-EmacsIcon8-icon"
          - "--with-EmacsIcon9-icon"
          - "--with-gnu-head-icon"
          - "--with-memeplex-slim-icon"
          - "--with-memeplex-wide-icon"
          - "--with-modern-alecive-flatwoken-icon"
          - "--with-modern-asingh4242-icon"
          - "--with-modern-azhilin-icon"
          - "--with-modern-bananxan-icon"
          - "--with-modern-black-dragon-icon"
          - "--with-modern-black-gnu-head-icon"
          - "--with-modern-black-variant-icon"
          - "--with-modern-bokehlicia-captiva-icon"
          - "--with-modern-cg433n-icon"
          - "--with-modern-doom3-icon"
          - "--with-modern-doom-icon"
          - "--with-modern-mzaplotnik-icon"
          - "--with-modern-nuvola-icon"
          - "--with-modern-orange-icon"
          - "--with-modern-paper-icon"
          - "--with-modern-papirus-icon"
          - "--with-modern-pen-3d-icon"
          - "--with-modern-pen-black-icon"
          - "--with-modern-pen-lds56-icon"
          - "--with-modern-pen-icon"
          - "--with-modern-icon"
          - "--with-modern-purple-flat-icon"
          - "--with-modern-sexy-v1-icon"
          - "--with-modern-sexy-v2-icon"
          - "--with-modern-sjrmanning-icon"
          - "--with-modern-vscode-icon"
          - "--with-modern-yellow-icon"
          - "--with-nobu417-big-sur-icon"
          - "--with-retro-emacs-logo-icon"
          - "--with-retro-gnu-meditate-levitate-icon"
          - "--with-retro-sink-bw-icon"
          - "--with-retro-sink-icon"
          - "--with-spacemacs-icon"
          # iconset end

    env:
      HOMEBREW_GITHUB_REF: ${{ github.head_ref || github.ref }}
      HOMEBREW_GITHUB_REPOSITORY: ${{ github.repository }}
      HOMEBREW_GITHUB_ACTOR: ${{ github.actor }}

    steps:
      - uses: actions/checkout@v3

      - name: Build emacs-plus ${{ matrix.build_opts }}
        run: brew install Aliases/$(readlink Aliases/emacs-plus) ${{ matrix.build_opts }}

      - name: Test installation
        run: $(brew --prefix)/bin/emacs --batch --eval='(print (+ 2 2))'
